
회사에서 로그인 기능을 NextAuth를 이용해 구현해볼 일이 생겨서 학습중 

### 1. nextauth 패키지 설치

```js
npm install next-auth
```

### 2. router 경로 만들기 

* 현재 프로젝트에서는 Next.js 14 버전을 사용중이므로 app 라우터 경로 기준으로 작성
* 현재 프로젝트에서는 바로 상위 폴더에 authOptions을 따로 분리해두고 사용 

```js
//app/api/auth/[...nextauth]/route.ts

import NextAuth from "next-auth";

import { authOptions } from "@/app/api/auth/[...nextauth]/AuthOptions";

const handler = NextAuth(authOptions);

  
export { handler as GET, handler as POST };

```


### 3. SessionProvider로 감싸기

- 현재 프로젝트 (Next.js 14) 에선 서버 컴포넌트와 클라이언트 컴포넌트 분리를 위해 SessionProvider를 감싸는 client Component, NextAuth

### 4. 타입 확장 / .env에 환경변수 정의 

- 현재 프로젝트에서는 별도로 사용하던 User 타입이 있었으므로, (이름).d.ts 파일을 생성해 User 타입을 재정의했다.
- 환경변수로 NEXTAUTH_SECRET를 정의해주지 않으면 제대로 동작하지 않는다... 
	- [링크참고](https://next-auth.js.org/configuration/options#secret)
	- `openssl rand -base64 32`를 터미널에서 실행시키고 나온 값을 `NEXTAUTH_SECRET` 값으로 사용
- NEXTAUTH_URL는 배포 완료 후 사용될 도메인으로 설정해준다.

```js
// types/임의이름.d.ts
declare module "next-auth" {

  interface User {

    //임의의 유저 Type
  }

  

  interface Session {

    user: User;

  }

}

declare module "next-auth/jwt" {

  interface JWT {

    user: User;

  }

}

```

```js
//.env
NEXTAUTH_SECRET="임의로 생성시킨 값"

NEXTAUTH_URL=배포 후 사용될 url
```
